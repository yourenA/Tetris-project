"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,o,i){return o&&t(e.prototype,o),i&&t(e,i),e}}(),Block=function(){function t(e){_classCallCheck(this,t),this.siteSize=e.siteSize,this.arr=e.arr,this.BLOCK_SIZE=e.BLOCK_SIZE,this.curLeft=e.curLeft,this.curTop=e.curTop}return _createClass(t,[{key:"clockwise",value:function(t){for(var e=[],o=0;o<=t.length-1;o++){for(var i=[],r=t.length-1;r>=0;r--)i.push(t[r][o]);e.push(i)}console.log(e);var n=[],a=[];return this.checkArrWith1(e,function(t,e){n.push(e*this.BLOCK_SIZE),a.push(t*this.BLOCK_SIZE)}),{newArr:e,lefts:n,tops:a}}},{key:"checkArrWith1",value:function(t,e){for(var o=0;o<=t.length-1;o++){console.log(t[o]);for(var i=0;i<=t.length-1;i++)1==t[o][i]&&(console.log("i:",o," j:",i),e.call(this,o+this.curTop,i+this.curLeft))}}},{key:"draw",value:function(t,e){var o=document.createElement("div");o.className="activityModel",o.style.top=t*this.BLOCK_SIZE+"px",o.style.left=e*this.BLOCK_SIZE+"px",document.body.appendChild(o)}},{key:"getInterval",value:function(t,e){var o=document.querySelectorAll(".inactiveModel"),i=null,r=null,n=null;if(0===o.length)i=this.siteSize.top+this.siteSize.height,r=this.siteSize.left-this.BLOCK_SIZE,n=this.siteSize.left+this.siteSize.width;else{var a=[],l=[],s=[],c=!0,h=!1,u=void 0;try{for(var v,f=o[Symbol.iterator]();!(c=(v=f.next()).done);c=!0){var _=v.value,y=parseInt(_.style.left),p=parseInt(_.style.top);y===t&&a.push(p),p===e&&(y<t?l.push(y):y>t&&s.push(y)),i=0===a.length?this.siteSize.top+this.siteSize.height:Math.min.apply(Math,a),r=0===l.length?this.siteSize.left-this.BLOCK_SIZE:Math.max.apply(Math,l),n=0===s.length?this.siteSize+this.siteSize.width:Math.min.apply(Math,s)}}catch(t){h=!0,u=t}finally{try{!c&&f.return&&f.return()}finally{if(h)throw u}}}return{highest:i,leftmost:r,rightmost:n}}},{key:"canMove",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{canMoveRight:!0,canMoveDown:!0,canMoveLeft:!0};return this.checkArrWith1(t,function(t,i){var r=this.getInterval(i*this.BLOCK_SIZE,t*this.BLOCK_SIZE),n=r.highest,a=r.leftmost,l=r.rightmost;e?(this.BLOCK_SIZE*(i+1)>l&&(o.canMoveRight=!1),this.BLOCK_SIZE*(t+1)>n&&(o.canMoveDown=!1),this.BLOCK_SIZE*(i-1)<a&&(o.canMoveLeft=!1)):(this.BLOCK_SIZE*(i+1)>=l&&(o.canMoveRight=!1),this.BLOCK_SIZE*(t+1)>=n&&(o.canMoveDown=!1),this.BLOCK_SIZE*(i-1)<=a&&(o.canMoveLeft=!1))}),o}},{key:"move",value:function(){var t=this;document.onkeydown=function(e){var o=document.querySelectorAll(".activityModel"),i=void 0,r=void 0,n=void 0,a=void 0,l=e.keyCode;switch(console.log("key",l),l){case 37:if(n=t.canMove(t.arr).canMoveLeft){var s=!0,c=!1,h=void 0;try{for(var u,v=o[Symbol.iterator]();!(s=(u=v.next()).done);s=!0){var f=u.value;f.style.left=parseInt(f.style.left)-20+"px"}}catch(t){c=!0,h=t}finally{try{!s&&v.return&&v.return()}finally{if(c)throw h}}t.curLeft--}else console.log("can`t move left");break;case 38:var _=t.clockwise(t.arr),y=_.newArr,p=_.lefts,d=_.tops;if(i=t.canMove(y,!0),a=i.canMoveDown,r=i.canMoveRight,r&&r){t.arr=y;for(var w in p)o[w].style.left=p[w]+"px",o[w].style.top=d[w]+"px"}break;case 39:if(r=t.canMove(t.arr).canMoveRight){var S=!0,g=!1,m=void 0;try{for(var I,L=o[Symbol.iterator]();!(S=(I=L.next()).done);S=!0){var M=I.value;M.style.left=parseInt(M.style.left)+20+"px"}}catch(t){g=!0,m=t}finally{try{!S&&L.return&&L.return()}finally{if(g)throw m}}t.curLeft++}else console.log("can`t move right");break;case 40:if(a=t.canMove(t.arr).canMoveDown){var C=!0,k=!1,B=void 0;try{for(var E,O=o[Symbol.iterator]();!(C=(E=O.next()).done);C=!0){var K=E.value;K.style.top=parseInt(K.style.top)+20+"px"}}catch(t){k=!0,B=t}finally{try{!C&&O.return&&O.return()}finally{if(k)throw B}}t.curTop++}else console.log("can`t move down");break;default:console.log("请选择上下左右按键")}}}},{key:"init",value:function(){this.checkArrWith1(this.arr,this.draw);var t=document.querySelectorAll(".activityModel"),e=setTimeout(function o(){var i=this.canMove(this.arr).canMoveDown;if(i){var r=!0,n=!1,a=void 0;try{for(var l,s=t[Symbol.iterator]();!(r=(l=s.next()).done);r=!0){var c=l.value;c.style.top=parseInt(c.style.top)+this.BLOCK_SIZE+"px"}}catch(t){n=!0,a=t}finally{try{!r&&s.return&&s.return()}finally{if(n)throw a}}this.curTop++,setTimeout(o.bind(this),600)}else{console.log("can`t move down");for(var h=0;h<=t.length-1;h++)t[h].className="inactiveModel";_init(),clearTimeout(e)}}.bind(this),600)}}]),t}(),_init=function(){var t={arr:__arr__,siteSize:__siteSize__,BLOCK_SIZE:__BLOCK_SIZE__,curLeft:__curLeft__,curTop:__curTop__},e=new Block(t);e.init(),e.move()};window.onload=function(){console.log("window onload");var t=document.querySelector(".site"),e=window.getComputedStyle(t),o=e.width,i=e.height,r=e.left,n=e.top,a={width:parseInt(o),height:parseInt(i),left:parseInt(r),top:parseInt(n)},l=[[1,0],[1,0],[1,1]],s=20,c=parseInt((a.left+a.width/2)/s),h=parseInt(a.top/s);console.log("curLeft",c),console.log("curTop",h),window.__arr__=l,window.__siteSize__=a,window.__BLOCK_SIZE__=s,window.__curLeft__=c,window.__curTop__=h,_init()};